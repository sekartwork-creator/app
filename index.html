<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบเช็คชื่อเข้า-ออกงาน</title>
  <style>
    /* ===== Reset ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Kanit', sans-serif;
      background-color: #f9f9f9;
      color: #111;
      line-height: 1.6;
    }

    /* ===== Header ===== */
    header {
      background-color: #06C755;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    header h1 { font-size: 1.8rem; }

    /* ===== Main Container ===== */
    #mainContainer {
      max-width: 480px;
      margin: 20px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .form-group { margin-bottom: 16px; }
    label { font-weight: 600; display: block; margin-bottom: 6px; }
    select, textarea, input {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: #fff;
    }
    select:focus, textarea:focus, input:focus { border-color: #06C755; outline: none; }

    button {
      width: 100%;
      padding: 16px;
      font-size: 1.2rem;
      font-weight: 700;
      background-color: #06C755;
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background-color: #049645; }

    #result { text-align: center; margin-top: 20px; font-weight: bold; font-size: 1.2rem; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>

  <header>
    <h1>ระบบเช็คชื่อเข้า-ออกงาน</h1>
  </header>

  <div id="mainContainer">
    <!-- เลือกพนักงาน -->
    <div class="form-group">
      <label for="employeeSelect">เลือกพนักงาน</label>
      <select id="employeeSelect">
        <option value="">-- เลือกชื่อ --</option>
      </select>
    </div>

    <!-- บันทึกเพิ่มเติม -->
    <div class="form-group">
      <label for="note">รายละเอียดเพิ่มเติม (ไม่บังคับ)</label>
      <textarea id="note" rows="4" placeholder="ใส่เหตุผลหรือข้อความเพิ่มเติม..."></textarea>
    </div>

    <!-- ปุ่มเช็คชื่อ -->
    <button onclick="sendCheckIn()">เช็คชื่อเข้า</button>

    <!-- แสดงผลลัพธ์ -->
    <div id="result"></div>
  </div>

  <!-- เสียงแจ้งเตือน -->
  <audio id="successSound" src="https://firebasestorage.googleapis.com/v0/b/sekkport.appspot.com/o/new-notification-015-363677.mp3?alt=media&token=74f2ee1e-021a-4306-9d18-fcbe5d06291b"></audio>
  <audio id="errorSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>

  <script>
    const API_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // เปลี่ยนเป็น URL ของคุณ

    // โหลดรายชื่อพนักงานจาก Google Apps Script
    async function loadEmployees() {
      try {
        const res = await fetch(API_URL + "?action=getEmployees");
        const employees = await res.json();
        const select = document.getElementById("employeeSelect");
        employees.forEach(emp => {
          const option = document.createElement("option");
          option.value = emp.id;
          option.textContent = emp.name;
          select.appendChild(option);
        });
      } catch(err) {
        console.error("ไม่สามารถโหลดรายชื่อพนักงานได้:", err);
      }
    }

    // ส่งเช็คชื่อ
    async function sendCheckIn() {
      const select = document.getElementById("employeeSelect");
      const staffId = select.value;
      const name = select.options[select.selectedIndex].text;
      const note = document.getElementById("note").value;
      const resultDiv = document.getElementById("result");

      if(!staffId) {
        resultDiv.textContent = "กรุณาเลือกชื่อพนักงาน";
        resultDiv.className = "error";
        document.getElementById("errorSound").play();
        return;
      }

      try {
        const res = await fetch(API_URL + `?action=checkIn&name=${encodeURIComponent(name)}&staffId=${encodeURIComponent(staffId)}&note=${encodeURIComponent(note)}`);
        const data = await res.json();
        resultDiv.textContent = data.msg;
        resultDiv.className = data.status === "success" ? "success" : "error";
        if(data.status === "success") {
          document.getElementById("successSound").play();
        } else {
          document.getElementById("errorSound").play();
        }
      } catch(err) {
        console.error(err);
        resultDiv.textContent = "เกิดข้อผิดพลาดในการเช็คชื่อ";
        resultDiv.className = "error";
        document.getElementById("errorSound").play();
      }
    }

    // เรียกใช้ฟังก์ชันโหลดพนักงานเมื่อหน้าโหลด
    loadEmployees();
  </script>
</body>
</html>
